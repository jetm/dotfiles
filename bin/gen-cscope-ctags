#!/bin/bash
#
# Reload cross-reference for .c, .cpp, .h files
#

set -e

if [[ $1 == '' ]]; then
  echo "error: enter a path to scan .{c,cpp,h} files"
  exit 1
fi

CODE="$(readlink -e $1)"
csFILES=cscope.files

find ${CODE} -type f -not -iwholename '*.git*' -print \
  | grep -E '\.(c(pp)?|h)$' > ${CODE}/${csFILES}

cscope -u -b -q -i ${CODE}/${csFILES}

ctags \
  --extra=+q \
  --fields=+aiKmSz \
  --file-scope=yes \
  --if0=no \
  --C-kinds=+cmefglmpstuvx \
  -L ${CODE}/${csFILES}

# -k Kernel Mode, turns off the use of the default include dir
#    (usually /usr/include)  when  building the database, since kernel
#    source trees generally do not use it. NOT USED HERE!
#
# -u Unconditionally build the cross-reference file (assume that all
#    files have changed).
#
# -b Build the cross-reference only.
#
# -q Enable fast symbol lookup via an inverted index. This option
#    causes cscope to create 2 more files (default names cscope.in.out
#    and cscope.po.out). This allows a faster symbol search algorithm
#    that provides noticeably faster lookup performance  for large
#    projects.

